<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethics Escape Room - Introduction</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/game.css">
    <style>
        .intro-container-wrapper {
            width: 100%;
            height: 100vh;
            overflow-y: auto;
        }

        .intro-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .intro-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .intro-header h1 {
            color: var(--text-amber);
            font-size: 2.5rem;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .intro-header .subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            font-style: italic;
        }

        .intro-content {
            background: var(--bg-panel);
            border: 2px solid var(--border-color);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .intro-content h2 {
            color: var(--text-amber);
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .intro-content h2:first-child {
            margin-top: 0;
        }

        .warning-box {
            background: var(--accent-red);
            border: 2px solid var(--text-red);
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .warning-box h3 {
            color: var(--text-red);
            margin-bottom: 0.5rem;
        }

        .rules-list {
            margin-left: 2rem;
            margin-top: 1rem;
        }

        .rules-list li {
            margin-bottom: 0.5rem;
        }

        .start-button {
            display: block;
            width: 100%;
            max-width: 400px;
            margin: 3rem auto;
            padding: 1.5rem 3rem;
            background: var(--accent-green);
            border: none;
            color: var(--text-primary);
            font-size: 1.2rem;
            font-family: 'Courier New', monospace;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .start-button:hover {
            background: var(--text-amber);
            color: var(--bg-dark);
            transform: scale(1.05);
        }

        .credits {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }
    </style>
</head>

<body>
    <div class="intro-container-wrapper">
        <div class="intro-container">
            <div class="intro-header">
                <h1>Ethics Escape Room</h1>
                <p class="subtitle">Bringing a classic thought experiment to life</p>
            </div>

            <div class="intro-content">
                <div class="warning-box">
                    <h3>⚠️ Content Warning</h3>
                    <p>The escape room explores the ethical debate around torture as an interrogational practice. The
                        activity does not contain any graphic content, but the topic may be unsettling to some people.
                    </p>
                </div>

                <h2>Welcome</h2>
                <p>Welcome to the Department of Homeland Security (DHS). You work for a team called the Moral Defense
                    Oversight Service (MDOS) that provides ethical guidance to DHS. We have invited you to take part in
                    a
                    serious, classified case that concerns the safety of your fellow Americans.</p>

                <p>In particular, we have been notified of a possible terrorist attack that if credible will occur
                    within
                    the next 24 hours. We are asking for your guidance to help shape how we conduct our investigation in
                    an
                    ethical yet timely manner. In particular, we want you to design an authorization form regarding
                    intelligence procurement from suspects.</p>

                <p>The room you are in is secure and full of documents that may be of interest. Unfortunately, we were
                    informed too late of the scenario to organize briefing materials or decode documents. All briefing
                    materials are present in the room but need to be found and all codes are in the form of a number.
                    When
                    you have decided on a form, please submit it in the box below.</p>

                <p>Please be mindful of the time you take for this very important decision. We only have 24 hours to
                    gather
                    intelligence and act on the threat at hand, meaning we need a final authorization form in less than
                    one
                    hour. We will check up on you throughout this hour for updates.</p>

                <h2>How to Play</h2>
                <ul class="rules-list">
                    <li>You have <strong>60 minutes</strong> to complete the escape room</li>
                    <li>Explore the digital environment to discover clues and documents</li>
                    <li>Some documents are encoded and require codes to unlock</li>
                    <li>Solve ethical puzzles to progress through the game</li>
                    <li>All discovered clues will be saved in your sidebar for reference</li>
                    <li>When time expires, you must select one of the authorization forms</li>
                    <li>Your progress is automatically saved... but the timer keeps running</li>
                </ul>

                <h2>Objective</h2>
                <p>Your goal is to gather information about the ethical dimensions of this scenario and decide which
                    authorization form should be used for interrogating the suspect. You may discover a third, custom
                    form
                    option through your investigation.</p>
            </div>

            <div class="intro-content" id="team-selection-section">
                <h2>Team Selection</h2>
                <p>Select the number of players on your team, then choose your code name. Each player on your team must
                    choose a different code name.</p>

                <div style="margin-bottom: 1.5rem;">
                    <label for="team-size-select"
                        style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Number of
                        Players:</label>
                    <select id="team-size-select"
                        style="width: 100%; padding: 0.75rem; background: var(--bg-darker); border: 1px solid var(--border-color); color: var(--text-primary); font-family: 'Courier New', monospace; font-size: 1rem;">
                        <option value="">Select team size...</option>
                        <option value="1">1 Player</option>
                        <option value="2">2 Players</option>
                        <option value="3">3 Players</option>
                        <option value="4">4 Players</option>
                    </select>
                </div>

                <div id="code-name-selection" style="display: none;">
                    <label style="display: block; margin-bottom: 0.5rem; color: var(--text-secondary);">Choose Your Code
                        Name:</label>
                    <div id="code-name-tiles"
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                    </div>
                </div>

                <p id="team-error" style="color: var(--text-red); display: none; margin-top: 1rem;"></p>
            </div>

            <button class="start-button" onclick="startGame()" id="start-game-btn">Start Game</button>

            <div class="credits">
                <p>Produced by Christina Qiu, Maria Gargiulo, Vinesh Kannan, and Zhi Keng He.</p>
                <p>Thank you to Coding It Forward and all the players who tested the game!</p>
            </div>
        </div>
    </div>

    <script src="js/game.js"></script>
    <script>
        // CODE_NAMES and CODE_NAME_ICONS are already defined in game.js
        // Make function globally accessible
        window.updateCodeNameOptions = function updateCodeNameOptions() {
            const teamSizeSelect = document.getElementById('team-size-select');
            const codeNameSelection = document.getElementById('code-name-selection');
            const codeNameTiles = document.getElementById('code-name-tiles');
            const teamSize = parseInt(teamSizeSelect.value);

            if (!teamSize || teamSize < 1 || teamSize > 4) {
                codeNameSelection.style.display = 'none';
                saveTeamData();
                return;
            }

            // Show code name selection
            codeNameSelection.style.display = 'block';

            // Clear existing tiles
            codeNameTiles.innerHTML = '';

            // Create radio tiles for available code names
            for (let i = 0; i < teamSize; i++) {
                const codeName = CODE_NAMES[i];
                const icon = CODE_NAME_ICONS[i];

                const tile = document.createElement('label');
                tile.style.cssText = 'display: flex; align-items: center; gap: 0.75rem; padding: 1rem; background: var(--bg-darker); border: 2px solid var(--border-color); cursor: pointer; transition: all 0.3s; font-family: "Courier New", monospace;';
                tile.onmouseover = function () {
                    if (!tile.querySelector('input').checked) {
                        this.style.borderColor = 'var(--text-amber)';
                        this.style.background = 'var(--bg-panel)';
                    }
                };
                tile.onmouseout = function () {
                    if (!tile.querySelector('input').checked) {
                        this.style.borderColor = 'var(--border-color)';
                        this.style.background = 'var(--bg-darker)';
                    }
                };

                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = 'code-name';
                radio.value = i.toString();
                radio.id = `code-name-${i}`;
                radio.style.cursor = 'pointer';
                radio.onchange = function () {
                    // Update tile styles
                    document.querySelectorAll('#code-name-tiles label').forEach(t => {
                        if (t.querySelector('input').checked) {
                            t.style.borderColor = 'var(--text-amber)';
                            t.style.background = 'var(--bg-panel)';
                        } else {
                            t.style.borderColor = 'var(--border-color)';
                            t.style.background = 'var(--bg-darker)';
                        }
                    });
                    saveTeamData();
                };

                const iconSpan = document.createElement('span');
                iconSpan.textContent = icon;
                iconSpan.style.fontSize = '1.5rem';

                const nameSpan = document.createElement('span');
                nameSpan.textContent = codeName;
                nameSpan.style.color = 'var(--text-primary)';

                tile.appendChild(radio);
                tile.appendChild(iconSpan);
                tile.appendChild(nameSpan);
                codeNameTiles.appendChild(tile);
            }

            // Restore saved code name selection if it exists (without calling loadTeamData to avoid recursion)
            const currentPlayerIndex = localStorage.getItem('currentPlayerIndex');
            if (currentPlayerIndex !== null && parseInt(currentPlayerIndex) < teamSize) {
                const radio = document.getElementById(`code-name-${currentPlayerIndex}`);
                if (radio) {
                    radio.checked = true;
                    // Trigger style update
                    radio.dispatchEvent(new Event('change'));
                }
            }
        }

        function saveTeamData() {
            const teamSizeSelect = document.getElementById('team-size-select');
            const teamSize = parseInt(teamSizeSelect.value);

            if (!teamSize || teamSize < 1 || teamSize > 4) {
                localStorage.removeItem('teamMembers');
                localStorage.removeItem('teamSize');
                localStorage.removeItem('currentPlayerIndex');
                document.getElementById('team-error').style.display = 'none';
                return;
            }

            // Create team members array with code names
            const teamMembers = CODE_NAMES.slice(0, teamSize);
            localStorage.setItem('teamMembers', JSON.stringify(teamMembers));
            localStorage.setItem('teamSize', teamSize.toString());

            // Save current player index
            const selectedCodeName = document.querySelector('input[name="code-name"]:checked');
            if (selectedCodeName) {
                localStorage.setItem('currentPlayerIndex', selectedCodeName.value);
                document.getElementById('team-error').style.display = 'none';
            } else {
                localStorage.removeItem('currentPlayerIndex');
            }
        }

        function loadTeamData() {
            const teamSize = parseInt(localStorage.getItem('teamSize') || '0');
            const currentPlayerIndex = localStorage.getItem('currentPlayerIndex');

            if (teamSize > 0 && teamSize <= 4) {
                // Restore team size selection
                const teamSizeSelect = document.getElementById('team-size-select');
                const currentValue = teamSizeSelect.value;
                const newValue = teamSize.toString();

                // Only set value if it's different to avoid triggering onchange unnecessarily
                if (currentValue !== newValue) {
                    // Temporarily remove event listener to prevent recursion
                    teamSizeSelect.removeEventListener('change', updateCodeNameOptions);
                    teamSizeSelect.value = newValue;
                    teamSizeSelect.addEventListener('change', updateCodeNameOptions);
                }

                // Now call updateCodeNameOptions once (it will restore the radio selection internally)
                updateCodeNameOptions();
            }
        }

        function startGame() {
            const teamSizeSelect = document.getElementById('team-size-select');
            const teamSize = parseInt(teamSizeSelect.value);

            if (!teamSize || teamSize < 1 || teamSize > 4) {
                document.getElementById('team-error').textContent = 'Please select the number of players on your team.';
                document.getElementById('team-error').style.display = 'block';
                return;
            }

            // Check if a code name is selected
            const selectedCodeName = document.querySelector('input[name="code-name"]:checked');
            if (!selectedCodeName) {
                document.getElementById('team-error').textContent = 'Please select your code name.';
                document.getElementById('team-error').style.display = 'block';
                return;
            }

            // Save team data one more time
            saveTeamData();

            // Start a new game
            GameState.startNewGame();

            // Redirect to game page
            window.location.href = 'game.html';
        }

        // Attach event listener for team size select after DOM loads
        window.addEventListener('DOMContentLoaded', function () {
            const teamSizeSelect = document.getElementById('team-size-select');
            if (teamSizeSelect) {
                teamSizeSelect.addEventListener('change', updateCodeNameOptions);
            }
            loadTeamData();
        });
    </script>
</body>

</html>